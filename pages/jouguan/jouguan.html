<!--
    jouguan.html（jouguan／酒館經營頁）

    用途：
    - 提供 jouguan（酒館）場景的互動 UI（來客自動結算 + 懸浮面板）
    - 顯示「經營（jinin）」/「技能（skill）」/「數據（data）」面板
    - 提供 item tooltip（提示框）顯示 item 的 info

    影響範圍：
    - 會讀寫 window.playerData（全域狀態）：例如 upgrades / unlockedItems / learnedSkills
    - 會依賴外部腳本建立資料表：pages/jouguan/jinin.js（JININ_ITEMS）、pages/jouguan/skill.js（SKILL_ITEMS）
    - 會依賴 pages/jouguan/jouguan.js 提供全域 API：window.purchaseItem / window.learnSkill

    教學：
    - 本檔案會被 main.js 的 loadPage() 動態插入到 index.html 的 #main-content
    - 因此這裡不需要完整的 <html>/<head>/<body>，只要提供「頁面內容」即可
-->

<!--
    #jouguan-wrapper（本頁主容器）
    用途：提供相對定位基準，讓懸浮控制與 tooltip 可以正確定位
    影響範圍：本頁所有 UI 都包在這裡，事件委派也會以這個區塊為主
-->
<div id="jouguan-wrapper">
    <div id="jouguan-content">
        <!-- 點擊區域，觸發金幣產出，顯示標題與提示 -->
        <h2>jouguan</h2>
    </div>

        <!-- 懸浮控制按鈕與面板
            用途：切換經營、技能、數據等功能面板
            影響範圍：浮動面板內容、互動按鈕、面板切換
        -->
    <!--
        #floating-controls-container（懸浮控制列）
        用途：放置「經營/技能/數據」三個按鈕與其對應面板
        影響範圍：
        - 透過 data-target 指向對應面板 id
        - 點擊按鈕後會切換 .open class 來顯示/隱藏面板
    -->
    <div id="floating-controls-container">
        <div class="control-group">
            <!--
                .floating-btn（面板切換按鈕）
                data-target：指定要打開哪個面板（panel-management）
                用途：點擊後顯示經營面板
                影響範圍：觸發 renderManagementPanel() 並切換 open
            -->
            <button class="floating-btn" data-target="panel-management">經營</button>
            <div id="panel-management" class="floating-panel management-panel">
                <div class="management-purchasable">
                    <!-- 可購買項目將動態生成於此 -->
                </div>
                <hr class="panel-separator">
                <div class="management-purchased">
                    <!-- 已購買項目將動態生成於此 -->
                </div>
            </div>
        </div>
        <div class="control-group">
            <!-- 技能面板：內容由 renderSkillsPanel() 動態生成 -->
            <button class="floating-btn" data-target="panel-skills">技能</button>
            <div id="panel-skills" class="floating-panel">

            </div>
        </div>
        <div class="control-group">
            <!-- 數據面板：內容由 renderDataPanel() 動態生成 -->
            <button class="floating-btn" data-target="panel-data">數據</button>
            <div id="panel-data" class="floating-panel">
            </div>
        </div>
    </div>

        <!-- 用於顯示懸浮說明的工具提示框
            用途：滑鼠移至項目時顯示詳細說明
        -->
    <!--
        #item-tooltip（提示框 / tooltip）
        用途：滑鼠移到 item 方形按鈕上時，在游標旁顯示該 item 的 info
        影響範圍：只影響顯示，不會改動任何玩家狀態
    -->
    <div id="item-tooltip" class="tooltip"></div>
</div>

<style>
        /*
            這段 style 是 jouguan 頁面的「頁面內樣式」

            用途：
            - 定義 jouguan 場景的主互動區（#jouguan-content）
            - 定義點擊 +金幣 的浮動文字（.floating-text）動畫

            影響範圍：
            - 只影響本頁插入後的 DOM
        */
    #jouguan-wrapper {
        position: relative;
        width: 100%;
        height: 100%;
    }
    #jouguan-content {
        height: 100%;
        width: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        cursor: default;
        position: relative;
        user-select: none; /* 防止點擊時選取文字 */
        background-color: #f0f8ff;
        border-radius: 10px;
    }

    /*
        .floating-text（點擊回饋文字）
        用途：顯示 "+X" 並向上漂浮後淡出
        影響範圍：視覺回饋，不影響實際金幣計算
    */
    .floating-text {
        position: absolute;
        font-size: 1.5rem;
        font-weight: bold;
        color: #DAA520; /* 金色 */
        pointer-events: none; /* 讓文字不影響滑鼠事件 */
        animation: float-up 1s ease-out forwards;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    }

    /*
        @keyframes float-up（漂浮動畫）
        用途：控制 .floating-text 的移動與透明度變化
        影響範圍：只影響使用 animation: float-up 的元素
    */
    @keyframes float-up {
        0% {
            transform: translateY(0);
            opacity: 1;
        }
        100% {
            transform: translateY(-50px);
            opacity: 0;
        }
    }
</style>

<!-- 載入經營項目、技能、主邏輯腳本
    用途：初始化經營、技能、互動行為
    影響範圍：JININ_ITEMS、SKILL_ITEMS、互動事件
-->
<script src="pages/jouguan/jinin.js"></script>
<script src="pages/jouguan/skill.js"></script>
<script src="pages/jouguan/jouguan.js"></script>
<script src="pages/jouguan/jouguan-ui.js"></script>

<!-- 新增懸浮按鈕和面板的樣式 -->
<style>
    /*
        這段 style 是「懸浮按鈕/面板/tooltip」的樣式集合

        用途：
        - 把 items 顯示成方形按鈕（可購買/已購買；可學習/已學習）
        - 用粗分隔線把面板切成上下兩區
        - 定義 tooltip（游標旁提示框）外觀
        - 定義懸浮控制列與面板的位置與尺寸

        影響範圍：
        - 只影響 jouguan 頁面的面板 UI
    */

    /* --- 技能面板：上半部（可學習） --- */
    .skill-purchasable {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 10px;
    }

    /* --- 技能面板：下半部（已學習） --- */
    .skill-purchased {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 10px;
    }

    /*
        .skill-item-btn（技能按鈕：可學習）
        用途：把技能顯示成方形按鈕
        影響範圍：只影響技能面板上半部的互動按鈕
    */
    .skill-item-btn {
        aspect-ratio: 1 / 1; /* 確保為正方形 */
        padding: 5px;
        font-size: 0.8rem;
        background-color: #f0f0f0;
        border: 1px solid #ccc;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        word-break: break-word; /* 處理長文字 */
        background-color: #e6f7ff; /* 淡藍色背景 */
        border-color: #91d5ff;
    }
    .skill-item-btn:hover {
        background-color: #bae7ff;
    }

    /*
        .skill-item-btn.unaffordable（技能買不起）
        用途：用半透明/禁止游標提示不可點
        影響範圍：仍可 hover 顯示 tooltip，但 click handler 會忽略
    */
    .skill-item-btn.unaffordable {
        opacity: 0.6;
        background-color: #f8f8f8;
        cursor: not-allowed;
    }

    /*
        .skill-item-owned（技能已學習）
        用途：顯示在下半部，並讓它看起來是「已擁有」狀態
        影響範圍：只影響技能面板下半部
    */
    .skill-item-owned {
        aspect-ratio: 1 / 1;
        padding: 5px;
        font-size: 0.8rem;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        word-break: break-word;
        cursor: default;

        background-color: #e8f4e8; /* 淡綠色背景表示已擁有 */
        color: #3a5a3a;
        border: 1px solid #b8d8b8;
    }
    /* --- 面板分隔線（粗線，上下兩區） --- */
    .panel-subtitle {
        margin-top: 0;
        margin-bottom: 10px;
        font-size: 1rem;
        color: #555;
        border-bottom: 1px solid #eee;
        padding-bottom: 5px;
    }
    .panel-separator {
        border: none;
        border-top: 4px solid #ccc;
        margin: 20px 0;
    }

    /* --- 經營面板：下半部（已購買） --- */
    .management-purchased {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
        gap: 10px;
    }
    .mgmt-item-owned {
        background-color: #e8f4e8; /* 淡綠色背景表示已擁有 */
        color: #3a5a3a;
        border: 1px solid #b8d8b8;
        aspect-ratio: 1 / 1;
        padding: 5px;
        font-size: 0.8rem;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        word-break: break-word;
        cursor: default;
    }

    /* --- 經營面板：整體為上下排列 --- */
    .management-panel {
        display: flex;
        flex-direction: column;
    }

    /* --- 經營面板：上半部（可購買） --- */
    .management-purchasable {
        display: grid;
        /* 縮小購買按鈕尺寸為原本的 75%：將最小格寬從 80px 調整為 60px */
        grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
        gap: 10px;
    }
    .mgmt-item-btn {
        aspect-ratio: 1 / 1; /* 確保為正方形 */
        padding: 4px; /* 稍微減少內距 */
        font-size: 0.7rem; /* 縮小字體以配合按鈕尺寸 */
        background-color: #e9f7ec; /* 可購買：淡綠色 */
        border: 1px solid #8fd19a;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        word-break: break-word; /* 處理長文字 */
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .mgmt-item-btn.unaffordable {
        opacity: 0.55;
        background-color: #f5f5f7;
        border-color: #ddd;
        color: #888;
        filter: grayscale(60%);
        cursor: not-allowed;
        box-shadow: none;
    }

    /*
        .tooltip（游標旁提示框）
        用途：顯示 item.info（說明文字），跟著游標移動
        影響範圍：pointer-events: none 讓滑鼠不會被 tooltip 擋住
    */
    .tooltip {
        display: none;
        position: fixed; /* 相對於視窗定位 */
        background-color: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 8px 12px;
        border-radius: 5px;
        z-index: 100;
        pointer-events: none; /* 讓滑鼠可以穿透它 */
        font-size: 0.9rem;
        max-width: 250px;
    }

    /*
        #floating-controls-container（懸浮控制列的位置）
        用途：把控制列固定在左側中間
        影響範圍：面板會以此為基準靠右展開
    */
    #floating-controls-container {
        position: absolute;
        left: 30px;
        top: 50%;
        transform: translateY(-50%);
        z-index: 10;
        display: flex;
        flex-direction: column;
    }
    
    /*
        .control-group（按鈕+面板的包裝）
        用途：作為面板 absolute 定位的參考點
        影響範圍：面板會相對這個元素定位在按鈕右側
    */
    .control-group {
        position: relative; /* 為懸浮面板提供定位基準 */
    }

    /*
        .floating-btn（面板切換按鈕）
        用途：點擊後打開/關閉對應面板
        影響範圍：只影響 UI，不直接改動玩家狀態
    */
    .floating-btn {
        width: 80px;
        padding: 10px;
        font-size: 1rem;
        background-color: #3498db;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        transition: background-color 0.2s;
    }

    .floating-btn:hover {
        background-color: #2980b9;
    }

    /*
        .floating-panel（面板容器）
        用途：顯示經營/技能/數據內容
        影響範圍：
        - 預設 display:none
        - 加上 .open 後 display:block 來顯示
    */
    .floating-panel {
        display: none; /* 預設隱藏 */
        position: absolute; /* 相對於 .control-group 定位，緊鄰按鈕右側 */
        left: calc(100% + 10px); /* 緊鄰按鈕右側，保留 10px 間距 */
        top: 50%;
        transform: translateY(-50%);
        width: 300px;
        height: 320px; /* 固定高度 */
        padding: 20px;
        background-color: white;
        border: 1px solid #ccc;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        overflow-y: auto; /* 當內容超出時，顯示垂直滾動條 */
        z-index: 1000; /* 確保在控制群組上方 */
    }

    .floating-panel.open {
        display: block; /* 顯示面板 */
    }
</style>